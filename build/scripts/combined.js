function displaySensorGeoJSON(type,name,url,markerIcon){layerCount++;var currentSubGroup=eval(type);currentSubGroup.clearLayers();var currentMarker=L.geoJson(!1,{pointToLayer:function(e,t){markerCoords.push(t);var a=L.marker(t,{icon:markerIcon});return a},onEachFeature:function(e,t){if(oms.addMarker(t),"rdg"!=type){var a=fev.vars.currentEventName,r='<table class="table table-hover table-striped table-condensed wim-table"><caption class="popup-title">'+name+' | <span style="color:gray"> '+a+'</span></caption><tr><td><strong>STN Site Number: </strong></td><td><span id="siteName">'+e.properties.site_no+'</span></td></tr><tr><td><strong>Status: </strong></td><td><span id="status">'+e.properties.status+'</span></td></tr><tr><td><strong>City: </strong></td><td><span id="city">'+(""==e.properties.city||null==e.properties.city||void 0==e.properties.city?"<i>No city recorded</i>":e.properties.city)+'</span></td></tr><tr><td><strong>County: </strong></td><td><span id="county">'+e.properties.county+'</span></td></tr><tr><td><strong>State: </strong></td><td><span id="state">'+e.properties.state+'</span></td></tr><tr><td><strong>Latitude, Longitude (DD): </strong></td><td><span class="latLng">'+e.properties.latitude_dd.toFixed(4)+", "+e.properties.longitude_dd.toFixed(4)+'</span></td></tr><tr><td><strong>STN data page: </strong></td><td><span id="sensorDataLink"><b><a target="blank" href='+sensorPageURLRoot+e.properties.site_id+"&Sensor="+e.properties.instrument_id+">Sensor data page</a></b></span></td></tr></table>";t.bindPopup(r)}}});$.getJSON(url,function(e){if(0==e.length)return void console.log("0 "+markerIcon.options.className+" GeoJSON features found");if(e.features.length>0){console.log(e.features.length+" "+markerIcon.options.className+" GeoJSON features found");for(var t=e.features.length-1;t>=0;t--)(isNaN(e.features[t].geometry.coordinates[0])||isNaN(e.features[t].geometry.coordinates[1]))&&(console.error("Bad latitude or latitude value for point: ",e.features[t]),e.features.splice(t,1)),(fev.vars.extentSouth<=e.features[t].geometry.coordinates[0]<=fev.vars.extentNorth&&fev.vars.extentWest<=e.features[t].geometry.coordinates[1]<=fev.vars.extentEast||0==e.features[t].geometry.coordinates[0]||0==e.features[t].geometry.coordinates[1])&&(console.error("Bad latitude or latitude value for point: ",e.features[t]),e.features.splice(t,1));currentMarker.addData(e),currentMarker.eachLayer(function(e){e.addTo(currentSubGroup)}),currentSubGroup.addTo(map),"rdg"==currentSubGroup&&alert("RDG feature created"),checkLayerCount(layerCount)}})}function displayHWMGeoJSON(e,t,a,r){layerCount++,hwm.clearLayers();var s=L.geoJson(!1,{pointToLayer:function(e,t){markerCoords.push(t);var a=L.marker(t,{icon:r});return a},onEachFeature:function(e,a){if(void 0==e.properties.longitude_dd||void 0==e.properties.latitude_dd)return void console.log("Lat/lng undefined for HWM at site no: "+e.properties.site_no);(null==a.feature.geometry.coordinates[0]||null==a.feature.geometry.coordinates[1])&&console.log("null coordinates returned for "+e.properties.site_no),oms.addMarker(a);var r=fev.vars.currentEventName,s='<table class="table table-hover table-striped table-condensed wim-table"><caption class="popup-title">'+t+' | <span style="color:gray">'+r+'</span></caption><col style="width:50%"> <col style="width:50%"><tr><td><strong>STN Site No.: </strong></td><td><span id="hwmSiteNo">'+e.properties.site_no+'</span></td></tr><tr><td><strong>HWM Label: </strong></td><td><span id="hwmLabel">'+e.properties.hwm_label+'</span></td></tr><tr><td><strong>Elevation(ft): </strong></td><td><span id="hwmElev">'+e.properties.elev_ft+'</span></td></tr><tr><td><strong>Datum: </strong></td><td><span id="hwmWaterbody">'+e.properties.verticalDatumName+'</span></td></tr><tr><td><strong>Height Above Ground: </strong></td><td><span id="hwmHtAboveGnd">'+(void 0!==e.properties.height_above_gnd?e.properties.height_above_gnd:"<i>No value recorded</i>")+'</span></td></tr><tr><td><strong>Approval status: </strong></td><td><span id="hwmStatus">'+(void 0==e.properties.approval_id||0==e.properties.approval_id?'<button type="button" class="btn btn-sm data-disclaim" title="Click to view provisional data statement">Provisional <span class="glyphicon glyphicon-question-sign" aria-hidden="true"></button>':"Approved")+'</span></td></tr><tr><td><strong>Type: </strong></td><td><span id="hwmType"></span>'+e.properties.hwmTypeName+'</td></tr><tr><td><strong>Marker: </strong></td><td><span id="hwmMarker">'+e.properties.markerName+'</span></td></tr><tr><td><strong>Quality: </strong></td><td><span id="hwmQuality">'+e.properties.hwmQualityName+'</span></td></tr><tr><td><strong>Waterbody: </strong></td><td><span id="hwmWaterbody">'+e.properties.waterbody+'</span></td></tr><tr><td><strong>County: </strong></td><td><span id="hwmCounty">'+e.properties.countyName+'</span></td></tr><tr><td><strong>State: </strong></td><td><span id="hwmState">'+e.properties.stateName+'</span></td></tr><tr><td><strong>Latitude, Longitude (DD): </strong></td><td><span class="latLng">'+e.properties.latitude_dd.toFixed(4)+", "+e.properties.longitude_dd.toFixed(4)+'</span></td></tr><tr><td><strong>Description: </strong></td><td><span id="hwmDescription">'+e.properties.hwm_locationdescription+'</span></td></tr><tr><td><strong>Full data link: </strong></td><td><span id="sensorDataLink"><b><a target="blank" href='+hwmPageURLRoot+e.properties.site_id+"&HWM="+e.properties.hwm_id+">HWM data page</a></b></span></td></tr></table>";a.bindPopup(s)}});$.getJSON(a,function(e){if(0==e.length)return void console.log("0 "+r.options.className+" GeoJSON features found");if(e.features.length>0){console.log(e.features.length+" "+r.options.className+" GeoJSON features found");for(var t=e.features.length-1;t>=0;t--)(isNaN(e.features[t].geometry.coordinates[0])||isNaN(e.features[t].geometry.coordinates[1]))&&(console.error("Bad latitude or latitude value for point: ",e.features[t]),e.features.splice(t,1)),(fev.vars.extentSouth<=e.features[t].geometry.coordinates[0]<=fev.vars.extentNorth&&fev.vars.extentWest<=e.features[t].geometry.coordinates[1]<=fev.vars.extentEast||0==e.features[t].geometry.coordinates[0]||0==e.features[t].geometry.coordinates[1])&&(console.error("Bad latitude or latitude value for point: ",e.features[t]),e.features.splice(t,1));s.addData(e),s.eachLayer(function(e){e.addTo(hwm)}),hwm.addTo(map),checkLayerCount(layerCount)}})}function displayPeaksGeoJSON(e,t,a,r){layerCount++,peak.clearLayers();var s=L.geoJson(!1,{pointToLayer:function(e,t){markerCoords.push(t);var a=L.marker(t,{icon:r}).bindLabel("Peak: "+e.properties.peak_stage.toString());return a},onEachFeature:function(e,a){oms.addMarker(a);var r=fev.vars.currentEventName,s='<table class="table table-condensed table-striped table-hover wim-table"><caption class="popup-title">'+t+' | <span style="color:gray"> '+r+"</span></caption><tr><th>Peak Stage (ft)</th><th>Datum</th><th>Peak Date & Time (UTC)</th></tr><tr><td>"+e.properties.peak_stage+"</td><td>"+e.properties.vdatum+"</td><td>"+moment(e.properties.peak_date).format("dddd, MMMM Do YYYY, h:mm:ss a")+"</td></tr></table>";a.bindPopup(s)}});$.getJSON(a,function(e){if(0==e.length)return void console.log("0 "+r.options.className+" GeoJSON features found");if(e.features.length>0){console.log(e.features.length+" "+r.options.className+" GeoJSON features found");for(var t=e.features.length-1;t>=0;t--)(isNaN(e.features[t].geometry.coordinates[0])||isNaN(e.features[t].geometry.coordinates[1]))&&(console.error("Bad latitude or latitude value for point: ",e.features[t]),e.features.splice(t,1)),(fev.vars.extentSouth<=e.features[t].geometry.coordinates[0]<=fev.vars.extentNorth&&fev.vars.extentWest<=e.features[t].geometry.coordinates[1]<=fev.vars.extentEast||0==e.features[t].geometry.coordinates[0]||0==e.features[t].geometry.coordinates[1])&&(console.error("Bad latitude or latitude value for point: ",e.features[t]),e.features.splice(t,1));s.addData(e),s.eachLayer(function(e){e.addTo(peak)}),peak.addTo(map),checkLayerCount(layerCount)}})}function populateEventDates(e){for(var t=0;t<fev.data.events.length;t++)fev.data.events[t].event_id==e&&(1==fev.data.events[t].event_status_id?fev.vars.currentEventActive=!0:fev.vars.currentEventActive=!1,fev.vars.currentEventStartDate_str=void 0==fev.data.events[t].event_start_date?"":fev.data.events[t].event_start_date.substr(0,10),fev.vars.currentEventEndDate_str=void 0==fev.data.events[t].event_end_date?"":fev.data.events[t].event_end_date.substr(0,10),console.log("Selected event is "+fev.data.events[t].event_name+". START date is "+fev.vars.currentEventStartDate_str+" and END date is "+fev.vars.currentEventEndDate_str+". Event is active = "+fev.vars.currentEventActive))}function checkLayerCount(e){e==fev.layerList.length&&markerCoords.length>0&&map.fitBounds(markerCoords)}function filterMapData(e,t){$(".esconder").hide(),$(".labelSpan").empty(),layerCount=0,markerCoords=[];var a="";if(a=e,null==e||void 0==e)return void alert("Please select an event to proceed");var r="";if(null!==$("#stateSelect").val()){var s=$("#stateSelect").val();if(r=s.toString(),$("#stateSelect").select2("data").length>0)for(var n=0;n<$("#stateSelect").select2("data").length;n++)$("#stateDisplay").append('<span class="label label-default">'+$("#stateSelect").select2("data")[n].text+"</span>");$("#locationGroupDiv").show(),$("#stateDisplay_li").show()}var o="";if(null!==$("#countySelect").val()){var i=$("#countySelect").val();if(o=i.toString(),$("#countySelect").select2("data").length>0)for(var n=0;n<$("#countySelect").select2("data").length;n++)$("#countyDisplay").append('<span class="label label-default">'+$("#countySelect").select2("data")[n].text+"</span>");$("#locationGroupDiv").show(),$("#countyDisplay_li").show()}(null!==$("#sensorTypeSelect").val()||null!==$("#sensorStatusSelect").val()||null!==$("#collectionConditionSelect").val()||null!==$("#deployTypeSelect").val())&&$("#sensorsGroupDiv").show();var l="";if(null!==$("#sensorTypeSelect").val()){var d=$("#sensorTypeSelect").val();if(l=d.toString(),$("#sensorTypeSelect").select2("data").length>0)for(var n=0;n<$("#sensorTypeSelect").select2("data").length;n++)$("#sensorTypeDisplay").append('<span class="label label-default">'+$("#sensorTypeSelect").select2("data")[n].text+"</span>");$("#sensorTypeDisplay_li").show()}var c="";if(null!==$("#sensorStatusSelect").val()){var p=$("#sensorStatusSelect").val();if(c=p.toString(),$("#sensorStatusSelect").select2("data").length>0)for(var n=0;n<$("#sensorStatusSelect").select2("data").length;n++)$("#sensorStatusDisplay").append('<span class="label label-default">'+$("#sensorStatusSelect").select2("data")[n].text+"</span>");$("#sensorStatusDisplay_li").show()}var u="";if(null!==$("#collectionConditionSelect").val()){var v=$("#collectionConditionSelect").val();if(u=v.toString(),$("#collectionConditionSelect").select2("data").length>0)for(var n=0;n<$("#collectionConditionSelect").select2("data").length;n++)$("#collectConditionDisplay").append('<span class="label label-default">'+$("#collectionConditionSelect").select2("data")[n].text+"</span>");$("#collectConditionDisplay_li").show()}var g="";if(null!==$("#deployTypeSelect").val()){var h=$("#deployTypeSelect").val();if(g=h.toString(),$("#deployTypeSelect").select2("data").length>0)for(var n=0;n<$("#deployTypeSelect").select2("data").length;n++)$("#deployTypeDisplay").append('<span class="label label-default">'+$("#deployTypeSelect").select2("data")[n].text+"</span>");$("#deployTypeDisplay_li").show()}fev.queryStrings.sensorsQueryString="?Event="+a+"&States="+r+"&County="+o+"&SensorType="+l+"&CurrentStatus="+c+"&CollectionCondition="+u+"&DeploymentType="+g,fev.urls.csvSensorsQueryURL=fev.urls.csvSensorsURLRoot+fev.queryStrings.sensorsQueryString,fev.urls.jsonSensorsQueryURL=fev.urls.jsonSensorsURLRoot+fev.queryStrings.sensorsQueryString,fev.urls.xmlSensorsQueryURL=fev.urls.xmlSensorsURLRoot+fev.queryStrings.sensorsQueryString,$("#sensorDownloadButtonCSV").attr("href",fev.urls.csvSensorsQueryURL),$("#sensorDownloadButtonJSON").attr("href",fev.urls.jsonSensorsQueryURL),$("#sensorDownloadButtonXML").attr("href",fev.urls.xmlSensorsQueryURL),(null!==$("#hwmTypeSelect").val()||null!==$("#hwmQualitySelect").val()||$("#coastal")[0].checked||$("#riverine")[0].checked||$("#surveyCompleteYes")[0].checked||$("#surveyCompleteNo")[0].checked||$("#stillWaterYes")[0].checked||$("#stillWaterNo")[0].checked)&&$("#hwmGroupDiv").show();var m="";if(null!==$("#hwmTypeSelect").val()){var f=$("#hwmTypeSelect").val();if(m=f.toString(),$("#hwmTypeSelect").select2("data").length>0)for(var n=0;n<$("#hwmTypeSelect").select2("data").length;n++)$("#hwmTypeDisplay").append('<span class="label label-default">'+$("#hwmTypeSelect").select2("data")[n].text+"</span>");$("#hwmTypeDisplay_li").show()}var S="";if(null!==$("#hwmQualitySelect").val()){var y=$("#hwmQualitySelect").val();if(S=y.toString(),$("#hwmQualitySelect").select2("data").length>0)for(var n=0;n<$("#hwmQualitySelect").select2("data").length;n++)$("#hwmQualityDisplay").append('<span class="label label-default">'+$("#hwmQualitySelect").select2("data")[n].text+"</span>");$("#hwmQualityDisplay_li").show()}var w=[];$("#coastal")[0].checked&&!$("#riverine")[0].checked&&(w.push("Coastal"),$("#hwmEnvDisplay_li").show(),$("#hwmEnvDisplay").html('<span class="label label-default">Coastal</span>')),$("#riverine")[0].checked&&!$("#coastal")[0].checked&&(w.push("Riverine"),$("#hwmEnvDisplay_li").show(),$("#hwmEnvDisplay").html('<span class="label label-default">Riverine</span>'));var b=w.toString(),L=[];$("#surveyCompleteYes")[0].checked&&!$("#surveyCompleteNo")[0].checked&&(L.push("true"),$("#hwmSurveyCompDisplay_li").show(),$("#hwmSurveyCompDisplay").html('<span class="label label-default">True</span>')),$("#surveyCompleteNo")[0].checked&&!$("#surveyCompleteYes")[0].checked&&(L.push("false"),$("#hwmSurveyCompDisplay_li").show(),$("#hwmSurveyCompDisplay").html('<span class="label label-default">False</span>'));var k=L.toString(),D=[];$("#stillWaterYes")[0].checked&&!$("#stillWaterNo")[0].checked&&(D.push("true"),$("#hwmStillWaterDisplay_li").show(),$("#hwmStillWaterDisplay").html('<span class="label label-default">True</span>')),$("#stillWaterNo")[0].checked&&!$("#stillWaterYes")[0].checked&&(D.push("false"),$("#hwmStillWaterDisplay_li").show(),$("#hwmStillWaterDisplay").html('<span class="label label-default">False</span>'));var N=D.toString();fev.queryStrings.hwmsQueryString="?Event="+a+"&States="+r+"&County="+o+"&HWMType="+m+"&HWMQuality="+S+"&HWMEnvironment="+b+"&SurveyComplete="+k+"&StillWater="+N,fev.urls.csvHWMsQueryURL=fev.urls.csvHWMsURLRoot+fev.queryStrings.hwmsQueryString,fev.urls.jsonHWMsQueryURL=fev.urls.jsonHWMsURLRoot+fev.queryStrings.hwmsQueryString,fev.urls.xmlHWMsQueryURL=fev.urls.xmlHWMsURLRoot+fev.queryStrings.hwmsQueryString,$("#hwmDownloadButtonCSV").attr("href",fev.urls.csvHWMsQueryURL),$("#hwmDownloadButtonJSON").attr("href",fev.urls.jsonHWMsQueryURL),$("#hwmDownloadButtonXML").attr("href",fev.urls.xmlHWMsQueryURL),(""!==$("#peakStartDate")[0].value||""!==$("#peakEndDate")[0].value)&&$("#peaksGroupDiv").show();var T;""!==$("#peakStartDate")[0].value&&($("#peakStartDisplay_li").show(),T=$("#peakStartDate")[0].value,$("#peakStartDisplay").html(moment(T).format("D MMM YYYY")));var _;""!==$("#peakEndDate")[0].value&&($("#peakEndDisplay_li").show(),_=$("#peakEndDate")[0].value,$("#peakEndDisplay").html(moment(_).format("D MMM YYYY"))),fev.queryStrings.peaksQueryString="?Event="+a+"&States="+r+"&County="+o+"&StartDate="+T+"&EndDate="+_,fev.urls.csvPeaksQueryURL=fev.urls.csvPeaksURLRoot+fev.queryStrings.peaksQueryString,fev.urls.jsonPeaksQueryURL=fev.urls.jsonPeaksURLRoot+fev.queryStrings.peaksQueryString,fev.urls.xmlPeaksQueryURL=fev.urls.xmlPeaksURLRoot+fev.queryStrings.peaksQueryString,$("#peaksDownloadButtonCSV").attr("href",fev.urls.csvPeaksQueryURL),$("#peaksDownloadButtonJSON").attr("href",fev.urls.jsonPeaksQueryURL),$("#peaksDownloadButtonXML").attr("href",fev.urls.xmlPeaksQueryURL),$.each(fev.layerList,function(e,t){"sensor"==t.Type&&displaySensorGeoJSON(t.ID,t.Name,fev.urls[t.ID+"GeoJSONViewURL"]+fev.queryStrings.sensorsQueryString,window[t.ID+"MarkerIcon"]),"hwm"==t.ID&&displayHWMGeoJSON(t.ID,t.Name,fev.urls.hwmFilteredGeoJSONViewURL+fev.queryStrings.hwmsQueryString,hwmMarkerIcon),"peak"==t.ID&&displayPeaksGeoJSON(t.ID,t.Name,fev.urls.peaksFilteredGeoJSONViewURL+fev.queryStrings.peaksQueryString,peakMarkerIcon)})}function queryNWISRainGages(e){var t={},a="active",r="00045,46529,72192",s="OC,OC-CO,ES,LK,ST,ST-CA,ST-DCH,ST-TS,AT,WE,SP",a="active",n="https://waterservices.usgs.gov/nwis/site/?format=mapper&bBox="+e+"&parameterCd="+r+"&siteType="+s+"&siteStatus="+a;console.log(n),$.ajax({url:n,dataType:"xml",data:t,success:function(e){$(e).find("site").each(function(){var e=$(this).attr("sno"),a=$(this).attr("sna"),r=$(this).attr("lat"),s=$(this).attr("lng");t[e]=L.marker([r,s],{icon:nwisRainMarkerIcon}),t[e].data={siteName:a,siteCode:e},t[e].data.parameters={},USGSRainGages.addLayer(t[e]),$("#nwisLoadingAlert").fadeOut(2e3)})},error:function(e){$("#nwisLoadingAlert").fadeOut(2e3)}})}function queryNWISrtGages(e){var t={},a="00065,62619,62620,63160,72214",r="OC,OC-CO,ES,LK,ST,ST-CA,ST-DCH,ST-TS",s="active",n="https://waterservices.usgs.gov/nwis/site/?format=mapper&bBox="+e+"&parameterCd="+a+"&siteType="+r+"&siteStatus="+s;$.ajax({url:n,dataType:"xml",success:function(e){$(e).find("site").each(function(){var e=$(this).attr("sno"),a=$(this).attr("sna"),r=$(this).attr("lat"),s=$(this).attr("lng");t[e]=L.marker([r,s],{icon:nwisMarkerIcon}),t[e].data={siteName:a,siteCode:e},t[e].data.parameters={},USGSrtGages.addLayer(t[e]),$("#nwisLoadingAlert").fadeOut(2e3)})},error:function(e){$("#nwisLoadingAlert").fadeOut(2e3)}})}function queryNWISgraphRDG(e){var t,a=fev.vars.currentEventName,r='<table class="table table-hover table-striped table-condensed"><caption class="popup-title">Rapid Deployment Gage | '+a+'</caption><tr><td><strong>STN Site Number: </strong></td><td><span id="siteName">'+e.layer.feature.properties.site_no+'</span></td></tr><tr><td><strong>Status: </strong></td><td><span id="status">'+e.layer.feature.properties.status+'</span></td></tr><tr><td><strong>City: </strong></td><td><span id="city">'+(""==e.layer.feature.properties.city||null==e.layer.feature.properties.city||void 0==e.layer.feature.properties.city?"<i>No city recorded</i>":e.layer.feature.properties.city)+'</span></td></tr><tr><td><strong>County: </strong></td><td><span id="county">'+e.layer.feature.properties.county+'</span></td></tr><tr><td><strong>State: </strong></td><td><span id="state">'+e.layer.feature.properties.state+'</span></td></tr><tr><td><strong>Latitude, Longitude (DD): </strong></td><td><span class="latLng">'+e.layer.feature.properties.latitude_dd.toFixed(4)+", "+e.layer.feature.properties.longitude_dd.toFixed(4)+'</span></td></tr><tr><td><strong>STN data page: </strong></td><td><span id="sensorDataLink"><b><a target="blank" href='+sensorPageURLRoot+e.layer.feature.properties.site_id+"&Sensor="+e.layer.feature.properties.instrument_id+'>Sensor data page</a></b></span></td></tr></table><div id="RDGgraphContainer" style="width:100%; height:250px;display:none;"></div><div id="RDGdataLink" style="width:100%;display:none;"><b><span class="rdg-nwis-info" style="color:red;"> - Provisional Data Subject to Revision -</span><br><span class="rdg-nwis-info">Additional parameters available at NWISWeb</span><br><a class="nwis-link" id="rdgNWISLink" target="_blank" href="https://usgs.gov"></a></b></div><div id="noDataMessage" style="width:100%;display:none;"><b><span>No NWIS Data Available for Graph</span></b></div>';e.layer.bindPopup(r).openPopup(),$.getJSON(stnServicesURL+"/Sites/"+e.layer.feature.properties.site_id+".json",function(e){if(e.usgs_sid.length>=8&&e.usgs_sid.length<=15){t=e.usgs_sid;var a="";if(""==fev.vars.currentEventEndDate_str&&(fev.vars.currentEventEndDate_str=moment().format("YYYY-MM-DD"),console.log("Selected event is active, so end date is today, "+fev.vars.currentEventEndDate_str)),""==fev.vars.currentEventStartDate_str||""==fev.vars.currentEventEndDate_str)$("#noDataMessage").show();else{a="&startDT="+fev.vars.currentEventStartDate_str+"&endDT="+fev.vars.currentEventEndDate_str;var r="https://waterdata.usgs.gov/nwis/uv?site_no="+t+"&begin_date="+fev.vars.currentEventStartDate_str+"&end_date="+fev.vars.currentEventEndDate_str;$("#rdgNWISLink").prop("href",r),$("#rdgNWISLink").html("Site "+t+' on NWISWeb <i class="fa fa-external-link" aria-hidden="true"></i>'),$.getJSON("https://nwis.waterservices.usgs.gov/nwis/iv/?format=nwjson&sites="+t+"&parameterCd=62620,00065,00067"+a,function(e){void 0==e.data?(console.log("No NWIS RDG data available for this time period"),$("#noDataMessage").show()):($("#RDGdataLink").show(),$("#RDGgraphContainer").show(),Highcharts.setOptions({global:{useUTC:!1}}),$("#RDGgraphContainer").highcharts({chart:{type:"line"},title:{text:"RDG water level, NWIS site "+t,align:"left",style:{color:"rgba(0,0,0,0.6)",fontSize:"small",fontWeight:"bold",fontFamily:"Open Sans, sans-serif"}},exporting:{filename:"FEV_RDG_NWISSite"+t},credits:{enabled:!0,text:"USGS NWIS",href:"https://waterdata.usgs.gov/nwis"},xAxis:{type:"datetime",labels:{formatter:function(){return Highcharts.dateFormat("%m/%d/%y",this.value)},align:"center"}},yAxis:{title:{text:"Gage Height, feet"}},series:[{showInLegend:!1,data:e.data[0].time_series_data,tooltip:{pointFormat:"Gage height: {point.y} feet"}}]}))})}}else $("#noDataMessage").show()})}function queryNWISgraph(e){var t="00065,62619,62620,63160,72279",a="";""==fev.vars.currentEventEndDate_str&&(fev.vars.currentEventEndDate_str=moment().format("YYYY-MM-DD")),a=""==fev.vars.currentEventStartDate_str||""==fev.vars.currentEventEndDate_str?"&period=P7D":"&startDT="+fev.vars.currentEventStartDate_str+"&endDT="+fev.vars.currentEventEndDate_str,e.layer.bindPopup('<label class="popup-title">NWIS Site '+e.layer.data.siteCode+"</br>"+e.layer.data.siteName+'</span></label></br><p id="graphLoadMessage"><span><i class="fa fa-lg fa-cog fa-spin fa-fw"></i> NWIS data graph loading...</span></p><div id="graphContainer" style="width:100%; height:200px;display:none;"></div> <a class="nwis-link" target="_blank" href="https://nwis.waterdata.usgs.gov/nwis/uv?site_no='+e.layer.data.siteCode+'"><b>Site '+e.layer.data.siteCode+' on NWISWeb <i class="fa fa-external-link" aria-hidden="true"></i></b></a><div id="noDataMessage" style="width:100%;display:none;"><b><span>NWIS water level data not available to graph</span></b></div>',{minWidth:350}).openPopup(),$.getJSON("https://nwis.waterservices.usgs.gov/nwis/iv/?format=nwjson&sites="+e.layer.data.siteCode+"&parameterCd="+t+a,function(t){void 0==t.data?(console.log("No NWIS data available for this time period"),$("#graphLoadMessage").hide(),$("#noDataMessage").show()):($("#graphLoadMessage").hide(),$(".popup-title").hide(),$("#graphContainer").show(),Highcharts.setOptions({global:{useUTC:!1}}),$("#graphContainer").highcharts({chart:{type:"line"},title:{text:"NWIS Site "+e.layer.data.siteCode+"<br> "+e.layer.data.siteName,align:"left",style:{color:"rgba(0,0,0,0.6)",fontSize:"small",fontWeight:"bold",fontFamily:"Open Sans, sans-serif"}},exporting:{filename:"FEV_NWIS_Site"+e.layer.data.siteCode},credits:{enabled:!1},xAxis:{type:"datetime",labels:{formatter:function(){return Highcharts.dateFormat("%d %b %y",this.value)},align:"center"}},yAxis:{title:{text:"Gage Height, feet"}},series:[{showInLegend:!1,data:t.data[0].time_series_data,tooltip:{pointFormat:"Gage height: {point.y} feet"}}]}))})}function queryNWISRaingraph(e){var t="00045,89363,46529,72192",a="";""==fev.vars.currentEventEndDate_str&&(fev.vars.currentEventEndDate_str=moment().format("YYYY-MM-DD")),a=""==fev.vars.currentEventStartDate_str||""==fev.vars.currentEventEndDate_str?"&period=P7D":"&startDT="+fev.vars.currentEventStartDate_str+"&endDT="+fev.vars.currentEventEndDate_str,e.layer.bindPopup('<label class="popup-title">NWIS Site '+e.layer.data.siteCode+"</br>"+e.layer.data.siteName+'</span></label></br><p id="graphLoadMessage"><span><i class="fa fa-lg fa-cog fa-spin fa-fw"></i> NWIS data graph loading...</span></p><div id="graphContainer" style="width:100%; height:200px;display:none;"></div> <a class="nwis-link" target="_blank" href="https://nwis.waterdata.usgs.gov/nwis/uv?site_no='+e.layer.data.siteCode+'"><b>Site '+e.layer.data.siteCode+' on NWISWeb <i class="fa fa-external-link" aria-hidden="true"></i></b></a><div id="noDataMessage" style="width:100%;display:none;"><b><span>NWIS water level data not available to graph</span></b></div>',{minWidth:350}).openPopup(),$.getJSON("https://nwis.waterservices.usgs.gov/nwis/iv/?format=nwjson&sites="+e.layer.data.siteCode+"&parameterCd="+t+a,function(t){if(void 0==t.data)console.log("No NWIS data available for this time period"),$("#graphLoadMessage").hide(),$("#noDataMessage").show();else{var t;t=2==t.data.length?t.data[1].time_series_data:t.data[0].time_series_data;var a=[],r=0;t.forEach(function(e,t){r+=e[1],a.push([e[0],r])}),$("#graphLoadMessage").hide(),$(".popup-title").hide(),$("#graphContainer").show(),Highcharts.setOptions({global:{useUTC:!1}}),$("#graphContainer").highcharts({chart:{type:"line"},title:{text:"NWIS Site "+e.layer.data.siteCode+"<br> "+e.layer.data.siteName,align:"left",style:{color:"rgba(0,0,0,0.6)",fontSize:"small",fontWeight:"bold",fontFamily:"Open Sans, sans-serif"}},exporting:{filename:"FEV_NWIS_Station"+e.layer.data.siteCode},credits:{enabled:!1},xAxis:{type:"datetime",labels:{formatter:function(){return Highcharts.dateFormat("%d %b %y",this.value)},align:"center"}},yAxis:{title:{text:"Precipitation total, inches"}},tooltip:{formatter:function(){return"Precipitation total: "+Highcharts.numberFormat(this.y,2,".")+" inches"}},series:[{turboThreshold:3e3,showInLegend:!1,data:a}]})}})}function addCommas(e){e+="";for(var t=e.split("."),a=t[0],r=t.length>1?"."+t[1]:"",s=/(\d+)(\d{3})/;s.test(a);)a=a.replace(s,"$1,$2");return a+r}function togglePeakLabels(){if(map.getZoom()<9)document.getElementById("peakCheckbox").disabled=!0;else if(map.getZoom()>=9){if(document.getElementById("peakCheckbox").disabled=!1,peakLabels===!1)return peak.eachLayer(function(e){e.showLabel()}),peakLabels=!0,void console.log("show");if(peakLabels===!0)return peak.eachLayer(function(e){e.hideLabel()}),peakLabels=!1,void console.log("hide")}}var layerCount=0,stnServicesURL="https://stn.wim.usgs.gov/STNServices",sensorPageURLRoot="https://stn.wim.usgs.gov/STNPublicInfo/#/SensorPage?Site=",hwmPageURLRoot="https://stn.wim.usgs.gov/STNPublicInfo/#/HWMPage?Site=",fev=fev||{data:{events:[],eventTypes:[],states:[],counties:[],sensorTypes:[],sensorStatusTypes:[],collectionConditions:[],deploymentTypes:[],hwmTypes:[],hwmQualities:[]},urls:{jsonSensorsURLRoot:stnServicesURL+"/Instruments/FilteredInstruments.json",xmlSensorsURLRoot:stnServicesURL+"/Instruments/FilteredInstruments.xml",csvSensorsURLRoot:stnServicesURL+"/Instruments/FilteredInstruments.csv",jsonHWMsURLRoot:stnServicesURL+"/HWMs/FilteredHWMs.json",xmlHWMsURLRoot:stnServicesURL+"/HWMs/FilteredHWMs.xml",csvHWMsURLRoot:stnServicesURL+"/HWMs/FilteredHWMs.csv",hwmFilteredGeoJSONViewURL:stnServicesURL+"/HWMs/FilteredHWMs.geojson",hwmGeoJSONViewURL:stnServicesURL+"/hwms.geojson",xmlPeaksURLRoot:stnServicesURL+"/PeakSummaries/FilteredPeaks.xml",jsonPeaksURLRoot:stnServicesURL+"/PeakSummaries/FilteredPeaks.json",csvPeaksURLRoot:stnServicesURL+"/PeakSummaries/FilteredPeaks.csv",peaksFilteredGeoJSONViewURL:stnServicesURL+"/PeakSummaries/FilteredPeaks.geojson",baroGeoJSONViewURL:stnServicesURL+"/SensorViews.geojson?ViewType=baro_view&",metGeoJSONViewURL:stnServicesURL+"/SensorViews.geojson?ViewType=met_view&",rdgGeoJSONViewURL:stnServicesURL+"/SensorViews.geojson?ViewType=rdg_view&",stormtideGeoJSONViewURL:stnServicesURL+"/SensorViews.geojson?ViewType=stormtide_view&",waveheightGeoJSONViewURL:stnServicesURL+"/SensorViews.geojson?ViewType=waveheight_view&"},queryStrings:{},vars:{currentEventName:"",currentEventID_str:"",currentEventStartDate_str:"",currentEventEndDate_str:"",currentEventActive:!1,extentNorth:71.3888898,extentWest:-179.148611,extentEast:-66.947028,extentSouth:18.910833},layerList:[{ID:"baro",Name:"Barometric Pressure Sensor",Type:"sensor",Category:"observed"},{ID:"stormtide",Name:"Storm Tide Sensor",Type:"sensor",Category:"observed"},{ID:"met",Name:"Meteorological Sensor",Type:"sensor",Category:"observed"},{ID:"waveheight",Name:"Wave Height Sensor",Type:"sensor",Category:"observed"},{ID:"rdg",Name:"Rapid Deployment Gage",Type:"sensor",Category:"real-time"},{ID:"hwm",Name:"High Water Mark",Type:"observed",Category:"observed"},{ID:"peak",Name:"Peak Summary",Type:"interpreted",Category:"interpreted"}]},map,markerCoords=[],oms,baroMarkerIcon=L.icon({className:"baroMarker",iconUrl:"images/baro.png",iconAnchor:[7,10],popupAnchor:[0,2]}),metMarkerIcon=L.icon({className:"metMarker",iconUrl:"images/met.png",iconAnchor:[7,10],popupAnchor:[0,2],iconSize:[16,16]}),rdgMarkerIcon=L.icon({className:"rdgMarker",iconUrl:"images/rdg.png",iconAnchor:[7,10],popupAnchor:[0,2],iconSize:[16,16]}),stormtideMarkerIcon=L.icon({className:"stormtideMarker",iconUrl:"images/stormtide.png",iconAnchor:[7,10],popupAnchor:[0,2],iconSize:[16,16]}),waveheightMarkerIcon=L.icon({className:"waveheightMarker",iconUrl:"images/waveheight.png",iconAnchor:[7,10],popupAnchor:[0,2],iconSize:[12,12]}),hwmMarkerIcon=L.icon({className:"hwmMarker",iconUrl:"images/hwm.png",iconAnchor:[7,10],popupAnchor:[0,2]}),peakMarkerIcon=L.icon({className:"peakMarker",iconUrl:"images/peak.png",iconAnchor:[7,10],popupAnchor:[0,2]}),nwisMarkerIcon=L.icon({className:"nwisMarker",iconUrl:"images/nwis.png",iconAnchor:[7,10],popupAnchor:[0,2]}),nwisRainMarkerIcon=L.icon({className:"nwisMarker",iconUrl:"images/rainIcon.png",iconAnchor:[7,10],popupAnchor:[0,2],iconSize:[30,30]}),baro=L.layerGroup(),stormtide=L.layerGroup(),met=L.layerGroup(),waveheight=L.layerGroup(),hwm=L.layerGroup(),peak=L.layerGroup(),editableLayers=new L.FeatureGroup,peakLabels=!1,rdg=L.featureGroup(),USGSRainGages=L.featureGroup(),USGSrtGages=L.featureGroup(),noaaService=L.esri.dynamicMapLayer({url:"https://nowcoast.noaa.gov/arcgis/rest/services/nowcoast/wwa_meteocean_tropicalcyclones_trackintensityfcsts_time/MapServer",opacity:.5,f:"image"}),noAdvisories=!1,test;$.ajax({url:"https://nowcoast.noaa.gov/layerinfo?request=legend&format=json&service=wwa_meteocean_tropicalcyclones_trackintensityfcsts_time",async:!1,dataType:"json",success:function(e){"No active advisories at this time"==e[0].label?(noAdvisories=!0,test=e,console.log(noAdvisories)):console.log("noaa layer added")}}),$(document).ready(function(){"use strict";function e(e,a,r,s,n){history.pushState(null,null,"#"+e.replace(/\s+/g,"")),fev.vars.currentEventName=e,fev.vars.currentEventID_str=a.toString(),1==r?fev.vars.currentEventActive=!0:fev.vars.currentEventActive=!1,fev.vars.currentEventStartDate_str=void 0==s?"":s.substr(0,10),fev.vars.currentEventEndDate_str=void 0==n?"":n.substr(0,10),console.log("Selected event is "+e+". START date is "+fev.vars.currentEventStartDate_str+" and END date is "+fev.vars.currentEventEndDate_str+". Event is active = "+fev.vars.currentEventActive),t(e,a,fev.vars.currentEventStartDate_str,fev.vars.currentEventEndDate_str)}function t(e,t,a,r){$("#eventNameDisplay").html(e),$("#largeEventNameDisplay").html(e);var s=[t.toString()];$("#evtSelect_filterModal").val([s]).trigger("change"),(""!=a||""!=r)&&(""==r?$("#largeEventDateRangeDisplay").html(moment(a).format("D MMM YYYY")):$("#largeEventDateRangeDisplay").html(moment(a).format("D MMM YYYY")+" thru "+moment(r).format("D MMM YYYY")))}function a(){$("#geosearchModal").modal("show")}function r(){$("#aboutModal").modal("show")}function s(){$("#filtersModal").modal("show")}function n(e){c&&map.removeLayer(c),c=L.esri.basemapLayer(e),map.addLayer(c),d&&map.removeLayer(d),("ShadedRelief"===e||"Oceans"===e||"Gray"===e||"DarkGray"===e||"Imagery"===e||"Terrain"===e)&&(d=L.esri.basemapLayer(e+"Labels"),
map.addLayer(d))}function o(){search_api.on("load",function(){$("#chkExtent").change(function(){if($(this).is(":checked")){console.log("Checked",map.getBounds().getSouth(),map.getBounds().getNorth(),map.getBounds().getWest(),map.getBounds().getEast());var e=map.getBounds();search_api.setOpts({LATmin:e.getSouth(),LATmax:e.getNorth(),LONmin:e.getWest(),LONmax:e.getEast()})}}),search_api.setOpts({textboxPosition:"user-defined",theme:"user-defined",DbSearchIncludeUsgsSiteSW:!0,DbSearchIncludeUsgsSiteGW:!0,DbSearchIncludeUsgsSiteSP:!0,DbSearchIncludeUsgsSiteAT:!0,DbSearchIncludeUsgsSiteOT:!0}),search_api.on("location-found",function(e){$("#geosearchModal").modal("hide");var t=14;"U.S. State or Territory"===e.Category&&(t=9),map.setView([e.y,e.x],t),L.popup().setLatLng([e.y,e.x]).setContent("<p><b>"+e.label+"</b> <br/><br/><b>NAME:            </b> "+e.name+"<br/><b>CATEGORY:        </b> "+e.category+"<br/><b>STATE:           </b> "+e.state+"<br/><b>COUNTY:          </b> "+e.county+"<br/><br/><b>LATITUDE:        </b> "+e.y+"<br/><b>LONGITUDE:       </b> "+e.x+"<br/><b>ELEVATION (FEET):</b> "+e.elevFt+"<br/><br/><b>PERCENT MATCH:   </b> "+e.pctMatch+"<br/></p>").openOn(map)}),search_api.on("no-result",function(){console.error("No location matching the entered text could be found.")}),search_api.on("timeout",function(){console.error("The search operation timed out.")})}),$("#searchSubmit").on("click",function(){console.log("in search submit"),$("#sapi-searchTextBox").keyup()})}function i(e){switch(e){case 19:return"1,128";case 18:return"2,256";case 17:return"4,513";case 16:return"9,027";case 15:return"18,055";case 14:return"36,111";case 13:return"72,223";case 12:return"144,447";case 11:return"288,895";case 10:return"577,790";case 9:return"1,155,581";case 8:return"2,311,162";case 7:return"4,622,324";case 6:return"9,244,649";case 5:return"18,489,298";case 4:return"36,978,596";case 3:return"73,957,193";case 2:return"147,914,387";case 1:return"295,828,775";case 0:return"591,657,550"}}if($("#peakDatePicker .input-daterange").datepicker({format:"yyyy-mm-dd",endDate:"today",startView:2,maxViewMode:3,todayBtn:!0,clearBtn:!0,multidate:!1,autoclose:!0,todayHighlight:!0}),$("#btnSubmitEvent").click(function(){if(null!==$("#evtSelect_welcomeModal").val()){$("#welcomeModal").modal("hide");var t=$("#evtSelect_welcomeModal").val()[0];$("#evtSelect_filterModal").val([t]).trigger("change"),$.getJSON("https://stn.wim.usgs.gov/STNServices/events/"+t+".json",{}).done(function(t){e(t.event_name,t.event_id,t.event_status_id,t.event_start_date,t.event_end_date)}).fail(function(){console.log("Request Failed. Most likely invalid event name.")}),filterMapData(t,!1)}else $(".eventSelectAlert").show()}),$("#btnSubmitFilters").on("click",function(){if(null!==$("#evtSelect_filterModal").val()){$("#welcomeModal").modal("hide");for(var t=$("#evtSelect_filterModal").val()[0],a=0;a<fev.data.events.length;a++)fev.data.events[a].event_id==t&&e(fev.data.events[a].event_name,fev.data.events[a].event_id,fev.data.events[a].event_status_id,fev.data.events[a].event_start_date,fev.data.events[a].event_end_date);filterMapData(t,!1),$(".eventSelectAlert").hide(),$("#filtersModal").modal("hide")}else $(".eventSelectAlert").show()}),window.location.hash){var l=window.location.hash.substring(1);$.getJSON("https://stn.wim.usgs.gov/STNServices/events/"+l+".json",{}).done(function(t){var a=t.event_id.toString();e(t.event_name,t.event_id,t.event_status_id,t.event_start_date,t.event_end_date),filterMapData(a,!0)}).fail(function(){console.log("Request Failed. Most likely invalid event name.")})}else $("#welcomeModal").modal({backdrop:"static",keyboard:!1});map=L.map("mapDiv").setView([39.833333,-98.583333],4);var d,c=L.esri.basemapLayer("Topographic").addTo(map);L.Icon.Default.imagePath="./images",USGSrtGages.addTo(map),noaaService.addTo(map);var p={"<img class='legendSwatch' src='images/nwis.png'>&nbsp;Real-time Stream Gage":USGSrtGages,"<img class='legendSwatch' src='images/rainIcon.png'>&nbsp;Real-time Rain Gage":USGSRainGages},u={},v={},g={};if(noAdvisories){var h=document.getElementById("noTrackAdvisory");h.innerHTML+="No Active Advisories"}else g={"<img class='legendSwatch' src='images/noaa.png'>&nbsp;NOAA Tropical Cyclone Forecast Track":noaaService};$.each(fev.layerList,function(e,t){"real-time"==t.Category&&(p["<img class='legendSwatch' src='images/"+t.ID+".png'>&nbsp;"+t.Name]=window[t.ID]),"observed"==t.Category&&(u["<img class='legendSwatch' src='images/"+t.ID+".png'>&nbsp;"+t.Name]=window[t.ID]),"interpreted"==t.Category&&(v["<img class='legendSwatch' src='images/"+t.ID+".png'></img>&nbsp;"+t.Name+"<label id='peakLabelToggle' style='display: inline-flex;left: 10px;bottom: 8px;' class='switch'><input id='peakCheckbox' type='checkbox'><span onclick='togglePeakLabels()' class='slider round'></span></label>"]=window[t.ID]),"noaa"==t.Category&&(g["<img class='legendSwatch' src='images/"+t.ID+".png'></img>&nbsp;"+t.Name]=window[t.ID])}),map.on("popupopen",function(){$(".data-disclaim").click(function(e){$("#aboutModal").modal("show"),$('.nav-tabs a[href="#disclaimerTabPane"]').tab("show")})}),map.on({overlayadd:function(e){if(-1!==e.name.indexOf("Stream Gage")&&(map.getZoom()<9&&USGSrtGages.clearLayers(),map.hasLayer(USGSrtGages)&&map.getZoom()>=9)){$("#nwisLoadingAlert").show();var t=map.getBounds().getSouthWest().lng.toFixed(7)+","+map.getBounds().getSouthWest().lat.toFixed(7)+","+map.getBounds().getNorthEast().lng.toFixed(7)+","+map.getBounds().getNorthEast().lat.toFixed(7);queryNWISrtGages(t)}},overlayadd:function(e){if(-1!==e.name.indexOf("Rain Gage")&&(map.getZoom()<9&&USGSRainGages.clearLayers(),map.hasLayer(USGSRainGages)&&map.getZoom()>=9)){$("#nwisLoadingAlert").show();var t=map.getBounds().getSouthWest().lng.toFixed(7)+","+map.getBounds().getSouthWest().lat.toFixed(7)+","+map.getBounds().getNorthEast().lng.toFixed(7)+","+map.getBounds().getNorthEast().lat.toFixed(7);queryNWISRainGages(t),USGSRainGages.bringToFront()}},overlayremove:function(e){"Cities"===e.name&&alert("removed")}});var m=L.control.layers(null,p,{collapsed:!1});m.addTo(map),$("#realTimeToggleDiv").append(m.onAdd(map)),$(".leaflet-top.leaflet-right").hide();var f=L.control.layers(null,u,{collapsed:!1});f.addTo(map),$("#observedToggleDiv").append(f.onAdd(map)),$(".leaflet-top.leaflet-right").hide();var S=L.control.layers(null,v,{collapsed:!1});S.addTo(map),$("#interpretedToggleDiv").append(S.onAdd(map)),$(".leaflet-top.leaflet-right").hide();var y=L.control.layers(null,g,{collapsed:!1});y.addTo(map),$("#noaaToggleDiv").append(y.onAdd(map)),$(".leaflet-top.leaflet-right").hide(),oms=new OverlappingMarkerSpiderfier(map,{keepSpiderfied:!0}),$("#sensorDownloadButtonCSV").attr("href",fev.urls.csvSensorsURLRoot),$("#sensorDownloadButtonJSON").attr("href",fev.urls.jsonSensorsURLRoot),$("#sensorDownloadButtonXML").attr("href",fev.urls.xmlSensorsURLRoot),$("#hwmDownloadButtonCSV").attr("href",fev.urls.csvHWMsURLRoot),$("#hwmDownloadButtonJSON").attr("href",fev.urls.jsonHWMsURLRoot),$("#hwmDownloadButtonXML").attr("href",fev.urls.xmlHWMsURLRoot),$("#peaksDownloadButtonCSV").attr("href",fev.urls.csvPeaksURLRoot),$("#peaksDownloadButtonJSON").attr("href",fev.urls.jsonPeaksURLRoot),$("#peaksDownloadButtonXML").attr("href",fev.urls.xmlPeaksURLRoot),$(".dataTypeRadio").each(function(){$(this).on("click",function(){var e=$(this).attr("id"),t=$("#"+e+"Form");t.show(),$(".hiddenForm").not(t).hide()})}),$(".check").on("click",function(){$(this).find("span").toggle()}),$("#geosearchNav").click(function(){a()}),$("#aboutNav").click(function(){r()}),$("#btnChangeFilters").click(function(){$("#evtSelect_filterModal").val([fev.vars.currentEventID_str]).trigger("change"),s()}),$(".basemapBtn").on("click",function(){var e=this.id.replace("btn","");switch(e){case"Streets":e="Streets";break;case"Satellite":e="Imagery";break;case"Topo":e="Topographic";break;case"Terrain":e="ShadedRelief";break;case"Gray":e="Gray";break;case"NatGeo":e="NationalGeographic"}n(e)});var w=document.createElement("script");w.src="https://txpub.usgs.gov/DSS/search_api/1.1/api/search_api.min.js",w.onload=function(){o()},document.body.appendChild(w),$("#legendButtonNavBar, #legendButtonSidebar").on("click",function(){$("#legend").toggle()}),$("#legendClose").on("click",function(){$("#legend").hide()}),map.on("load moveend zoomend",function(e){var t;if($.each(USGSrtGages.getLayers(),function(e,a){var r=a.getPopup();r&&(t=r._isOpen)}),$.each(USGSRainGages.getLayers(),function(e,a){var r=a.getPopup();r&&(t=r._isOpen)}),map.getZoom()<9&&(USGSrtGages.clearLayers(),USGSRainGages.clearLayers(),$("#rtScaleAlert").show(),peakLabels===!0))return peak.eachLayer(function(e){e.hideLabel()}),$("#peakCheckbox").click(),void(peakLabels=!1);if(map.getZoom()>=9&&$("#rtScaleAlert").hide(),map.hasLayer(USGSrtGages)&&map.getZoom()>=9&&!t){$("#nwisLoadingAlert").show();var a=map.getBounds().getSouthWest().lng.toFixed(7)+","+map.getBounds().getSouthWest().lat.toFixed(7)+","+map.getBounds().getNorthEast().lng.toFixed(7)+","+map.getBounds().getNorthEast().lat.toFixed(7);queryNWISrtGages(a),queryNWISRainGages(a),map.hasLayer(USGSrtGages)&&map.hasLayer(USGSRainGages)&&USGSRainGages.bringToFront()}if(map.hasLayer(USGSRainGages)&&map.getZoom()>=9&&!t){$("#nwisLoadingAlert").show();var a=map.getBounds().getSouthWest().lng.toFixed(7)+","+map.getBounds().getSouthWest().lat.toFixed(7)+","+map.getBounds().getNorthEast().lng.toFixed(7)+","+map.getBounds().getNorthEast().lat.toFixed(7);queryNWISRainGages(a),map.hasLayer(USGSRainGages)&&map.hasLayer(USGSRainGages)&&USGSRainGages.bringToFront()}}),USGSrtGages.on("click",function(e){queryNWISgraph(e)}),USGSRainGages.on("click",function(e){queryNWISRaingraph(e)}),rdg.on("click",function(e){queryNWISgraphRDG(e)}),map.whenReady(function(){var e=i(map.getZoom());$("#scale")[0].innerHTML=e,console.log("Initial Map scale registered as "+e,map.getZoom());var t=map.getCenter();$("#latitude").html(t.lat.toFixed(4)),$("#longitude").html(t.lng.toFixed(4))}),map.on("zoomend",function(){var e=map.getZoom(),t=i(e);$("#scale")[0].innerHTML=t,$("#zoomLevel")[0].innerHTML=e}),map.on("mousemove",function(e){$("#mapCenterLabel").css("display","none"),null!==e.latlng&&($("#latitude").html(e.latlng.lat.toFixed(4)),$("#longitude").html(e.latlng.lng.toFixed(4)))}),map.on("dragend",function(){$("#mapCenterLabel").css("display","inline");var e=map.getCenter();$("#latitude").html(e.lat.toFixed(4)),$("#longitude").html(e.lng.toFixed(4))})}),$(document).ready(function(){$("#btnClearFilters").click(function(){$(".clearable").val("").trigger("change"),$(".check").find("span").hide(),$(".check").removeClass("active"),$('.btn-group input[type="checkbox"]').prop("checked",!1)}),$("#evtTypeSelect").select2({placeholder:"All Types"}),$.ajax({dataType:"json",type:"GET",url:"https://stn.wim.usgs.gov/STNServices/eventtypes.json",headers:{Accept:"*/*"},success:function(e){e.sort(function(e,t){var a=e.TYPE,r=t.TYPE;return r>a?-1:a>r?1:0});for(var t=0;t<e.length;t++)$("#evtTypeSelect").append('<option value="'+e[t].event_type_id+'">'+e[t].type+"</option>"),fev.data.eventTypes.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$(".evtSelect").select2({placeholder:"Select event",allowClear:!1,maximumSelectionLength:1}),$.ajax({dataType:"json",type:"GET",url:"https://stn.wim.usgs.gov/STNServices/events.json",headers:{Accept:"*/*"},success:function(e){e.sort(function(e,t){var a=e.event_start_date,r=t.event_start_date;return a>r?-1:r>a?1:0});for(var t=0;t<e.length;t++)$(".evtSelect").append('<option value="'+e[t].event_id+'">'+e[t].event_name+"</option>"),e[t].id=e[t].event_id,fev.data.events.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#stateSelect").select2({placeholder:"All States"}),$.ajax({dataType:"json",type:"GET",url:"https://stn.wim.usgs.gov/STNServices/Sites/States.json",headers:{Accept:"*/*"},success:function(t){t.sort(function(e,t){var a=e.state_name,r=t.state_name;return r>a?-1:a>r?1:0});for(var a=0;a<t.length;a++)$("#stateSelect").append('<option value="'+t[a].state_abbrev+'">'+t[a].state_name+"</option>"),t[a].id=t[a],fev.data.states.push(t[a]);e()},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#countySelect").select2({placeholder:"All Counties"}),$("#countySelect").on("select2:select select2:unselect",function(e){}),$("#sensorTypeSelect").select2({placeholder:"All Types"}),$.ajax({dataType:"json",type:"GET",url:"https://stn.wim.usgs.gov/STNServices/sensortypes.json",headers:{Accept:"*/*"},success:function(e){e.sort(function(e,t){var a=e.TYPE,r=t.TYPE;return r>a?-1:a>r?1:0});for(var t=0;t<e.length;t++)$("#sensorTypeSelect").append('<option value="'+e[t].sensor_type_id+'">'+e[t].sensor+"</option>"),fev.data.sensorTypes.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#sensorStatusSelect").select2({placeholder:"All Statuses"}),$.ajax({dataType:"json",type:"GET",url:"https://stn.wim.usgs.gov/STNServices/statustypes.json",headers:{Accept:"*/*"},success:function(e){for(var t=0;t<e.length;t++)$("#sensorStatusSelect").append('<option value="'+e[t].status_type_id+'">'+e[t].status+"</option>"),fev.data.sensorStatusTypes.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#collectionConditionSelect").select2({placeholder:"All Conditions"}),$.ajax({dataType:"json",type:"GET",url:"https://stn.wim.usgs.gov/STNServices/InstrCollectConditions.json",headers:{Accept:"*/*"},success:function(e){for(var t=0;t<e.length;t++)$("#collectionConditionSelect").append('<option value="'+e[t].id+'">'+e[t].condition+"</option>"),fev.data.collectionConditions.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#deployTypeSelect").select2({placeholder:"All Deploy Types"}),$.ajax({dataType:"json",type:"GET",url:"https://stn.wim.usgs.gov/STNServices/deploymenttypes.json",headers:{Accept:"*/*"},success:function(e){for(var t=0;t<e.length;t++)$("#deployTypeSelect").append('<option value="'+e[t].deployment_type_id+'">'+e[t].method+"</option>"),fev.data.deploymentTypes.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#hwmTypeSelect").select2({placeholder:"All Types"}),$.ajax({dataType:"json",type:"GET",url:"https://stn.wim.usgs.gov/STNServices/hwmtypes.json",headers:{Accept:"*/*"},success:function(e){for(var t=0;t<e.length;t++)$("#hwmTypeSelect").append('<option value="'+e[t].hwm_type_id+'">'+e[t].hwm_type+"</option>"),e[t].id=e[t].hwm_type_id,fev.data.hwmTypes.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#hwmQualitySelect").select2({placeholder:"All Qualities"}),$.ajax({dataType:"json",type:"GET",url:"https://stn.wim.usgs.gov/STNServices/hwmqualities.json",headers:{Accept:"*/*"},success:function(e){for(var t=0;t<e.length;t++)$("#hwmQualitySelect").append('<option value="'+e[t].hwm_quality_id+'">'+e[t].hwm_quality+"</option>"),e[t].id=e[t].hwm_quality_id,fev.data.hwmQualities.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}});var e=function(){for(var e=0;e<fev.data.states.length;e++)$.ajax({dataType:"json",type:"GET",url:"https://stn.wim.usgs.gov/STNServices/Sites/CountiesByState.json?StateAbbrev="+fev.data.states[e].state_abbrev,headers:{Accept:"*/*"},currentState:fev.data.states[e].state_abbrev,success:function(e){fev.data.counties[this.currentState]=e},error:function(e){console.log("Error retrieving counties. The error is: "+e)}})};$("#stateSelect").on("select2:select select2:unselect",function(e){var t=$(this).val();if(!t>0||null===t)return $("#countySelect").html(""),void $("#countySelect").append("<option value=null>Please select state(s) first </option>");var a=[];for(var r in fev.data.counties)for(var s=0;s<fev.data.counties[r].length;s++){var n=fev.data.counties[r][s].county_name;t.indexOf(r)>-1&&(a=a.concat(n))}$("#countySelect").html("");for(var r in a){var o=a[r];$("#countySelect").append('<option value="'+o+'">'+o+"</option>")}})});